# טסטים לדשבורד הטוקנים

מדריך להרצת הטסטים עבור פונקציונליות הדשבורד ומערכת ניהול המפתחות.

## סוגי טסטים

### 1. טסטים בסיסיים (`dashboard_tests.py`)
- בדיקת חישוב טוקנים וסטטיסטיקות
- בדיקת לוגיקת מעבר מפתחות
- בדיקת פורמט נתוני הדאטבייס

### 2. טסטי אינטגרציה (`test_integration_dashboard.py`)
- בדיקת API endpoints
- בדיקת שמירת נתונים בדאטבייס
- סימולצית מעבר מפתחות אמיתי
- בדיקת חיבור בין השירותים

### 3. טסטי Frontend (`dashboard.test.tsx`)
- בדיקת רינדור הקומפוננט
- בדיקת תצוגת נתונים
- בדיקת עדכונים בזמן אמת

## הרצת הטסטים

### דרך 1: הרצה אוטומטית (מומלץ)
```bash
cd Apex/Afeka_ChatBot
python run_dashboard_tests.py
```

### דרך 2: הרצה ידנית

#### טסטים בסיסיים:
```bash
python tests/dashboard_tests.py
```

#### טסטי אינטגרציה:
```bash
# ודא שהשירותים רצים:
# Backend: http://localhost:8000
# AI Service: http://localhost:8001

python tests/test_integration_dashboard.py
```

#### טסטי Frontend:
```bash
cd src/frontend
npm test
```

## דרישות מוקדמות

### Python packages:
```bash
pip install requests pytest
```

### Node.js packages (לפרונטאנד):
```bash
npm install @testing-library/react @testing-library/jest-dom --save-dev
```

## מה הטסטים בודקים

### ✅ שמירת נתונים בדאטבייס
- רישום שימוש בטוקנים
- שמירת מספר בקשות
- עדכון זמן אמת של נתוני השימוש

### ✅ מעבר מפתחות
- זיהוי הגעה לסף (60% מ-15 בקשות = 9 בקשות)
- מעבר אוטומטי למפתח הבא
- עדכון סטטוס המפתחות

### ✅ תצוגת דאטה בדשבורד
- הצגת מפתח פעיל נוכחי
- סכום כל הטוקנים והבקשות
- נתוני דקה נוכחית
- טבלת סטטוס כל המפתחות

### ✅ API Integration
- `/api/key-management/status` - קבלת סטטוס
- `/api/chat` - שליחת הודעות
- `/status` (AI Service) - סטטוס שירות AI

## פתרון בעיות נפוצות

### שגיאת חיבור לשרתים
```
❌ לא ניתן להתחבר לשרת הבקאנד
```
**פתרון:** ודא שהשרתים רצים:
- Backend: `cd src/backend && python main.py`
- AI Service: `cd src/ai && python main.py`

### שגיאת חבילות חסרות
```
❌ requests חסר
```
**פתרון:** התקן חבילות:
```bash
pip install requests pytest
```

### טסטי Frontend נכשלים
**פתרון:** התקן את התלויות:
```bash
cd src/frontend
npm install
```

## דוגמאות לתוצאות טסטים

### הרצה מוצלחת:
```
🧪 מתחיל טסטי אינטגרציה לדשבורד

=== טסט 1: API הדשבורד ===
✅ API הדשבורד עובד
📊 מספר מפתחות: 7
🔑 מפתחות פעילים: 5

=== טסט 2: AI Service ===
✅ AI Service עובד
🤖 מפתח נוכחי: 0

=== טסט 3: שמירת נתונים ===
💾 בודק שמירת נתונים בדאטבייס...
📊 טוקנים לפני: 1196
📊 טוקנים אחרי: 1346
✅ נתונים נשמרו בדאטבייס!

=== טסט 4: מעבר מפתחות ===
🔄 מתחיל סימולצית מעבר מפתחות...
📍 מפתח התחלתי: 0
📨 שולח 15 בקשות מהירות...
📍 מפתח סופי: 1
✅ מעבר מפתחות הצליח!

📋 סיכום: 4/4 טסטים עברו
🎉 כל הטסטים עברו בהצלחה!
```

## הרצה תקופתית

מומלץ להריץ את הטסטים:
- לפני כל deployment
- אחרי שינויים במערכת ניהול המפתחות
- פעם ביום לוודא תקינות המערכת

```bash
# הרצה יומית אוטומטית
crontab -e
# הוסף שורה:
0 9 * * * cd /path/to/Apex/Afeka_ChatBot && python run_dashboard_tests.py
``` 