# עיבוד אוטומטי של מסמכים

## הבעיה שנפתרה

אחרי העלאת מסמכים למערכת, הם לא עובדו אוטומטית ליצירת embeddings והמשתמש היה צריך להפעיל סקריפט ידני כדי לעבד אותם. כעת, המסמכים יעובדו אוטומטית ברקע.

## פתרון

הפתרון מורכב מהחלקים הבאים:

1. **הפעלת מעבד אוטומטי**: השרת מפעיל תהליך רקע שבודק באופן קבוע אם יש מסמכים במצב "pending" ומעבד אותם אוטומטית.

2. **שליטה דרך משתנה סביבה**: הוספנו משתנה סביבה חדש בשם `AUTO_PROCESS_DOCUMENTS` שמאפשר להפעיל או לבטל את התכונה.

3. **שקיפות וניטור**: התהליך מתועד ב-logs כך שאפשר לעקוב אחר ההתקדמות וסטטוס העיבוד.

## איך זה עובד

1. כשהשרת מופעל, הוא בודק את משתנה הסביבה `AUTO_PROCESS_DOCUMENTS`.
2. אם הערך הוא `True` (ברירת המחדל), תהליך רקע מופעל שמריץ את הסקריפט `auto_process_documents.py`.
3. הסקריפט בודק כל 30 שניות אם יש מסמכים במצב "pending" בטבלת `documents`.
4. עבור כל מסמך שנמצא, הסקריפט:
   - מוריד את המסמך מה-storage
   - מחלק אותו לחלקים (chunks)
   - יוצר embeddings לכל חלק
   - מעדכן את סטטוס המסמך ל-"completed"

## הגדרות

כדי להפעיל או לבטל את התכונה, עדכן את קובץ `.env`:

```
# RAG Settings
AUTO_PROCESS_DOCUMENTS=True  # שנה ל-False כדי לבטל
```

## פתרון בעיות

אם המסמכים אינם מעובדים אוטומטית:

1. ודא שמשתנה הסביבה `AUTO_PROCESS_DOCUMENTS` מוגדר כ-`True`.
2. בדוק את ה-logs של השרת לקבלת הודעות שגיאה.
3. ודא ששרת ה-AI פועל, מכיוון שהוא נדרש לקבלת מידע על סטטוס המסמכים.
4. ודא שיש מספיק הרשאות למערכת לגשת ל-storage ולעדכן את בסיס הנתונים.

## יכולות נוספות

ניתן עדיין להשתמש בסקריפט `process_document.py` לעיבוד ידני של מסמך ספציפי:

```bash
python process_document.py <document_id>
```

שינוי זה משפר את חוויית המשתמש באופן משמעותי, מכיוון שהמסמכים יהיו מוכנים לחיפוש ללא התערבות ידנית מצד המשתמש.
