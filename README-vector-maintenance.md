# כלי תחזוקה למערכת הווקטורים

מסמך זה מתאר את כלי התחזוקה השונים למערכת הווקטורים במסד הנתונים של Afeka_ChatBot.

## הבעיות שכלים אלה פותרים

1. **עיבוד מסמכים גדולים מדי** - כאשר מסמך גדול מדי מועלה למערכת, עלולות להיווצר אלפי וקטורים שעלולים למלא את מסד הנתונים או לגרום לזמני עיבוד ארוכים מדי.
2. **מסמכים תקועים בסטטוס 'processing'** - לפעמים עיבוד מסמך נתקע ולא מסתיים בהצלחה, והמסמך נשאר במצב 'processing'.
3. **וקטורים יתומים** - וקטורים שאין להם מסמך אב (orphaned vectors) שעלולים להישאר במסד הנתונים לאחר מחיקת מסמך.

## הכלים

### 1. מחיקת מסמך ספציפי - delete_document.py

הכלי הבסיסי ביותר מאפשר למחוק מסמך ספציפי וכל הווקטורים הקשורים אליו.

```bash
python delete_document.py [document_id]
```

אם לא יצוין מזהה מסמך, יתבצע ניסיון למחוק את המסמך עם המזהה 120 (ברירת המחדל, ניתן לשנות בקוד).

### 2. ניקוי מסד הנתונים - cleanup_database.py

כלי מתקדם יותר המספק מספר אפשרויות ניקוי:

```bash
python cleanup_database.py [--delete-document DOCUMENT_ID]
```

ללא פרמטרים, הסקריפט יציג תפריט עם האפשרויות הבאות:

1. מחיקת מסמך ספציפי
2. ניקוי מסמכים תקועים בסטטוס 'processing'
3. ניקוי וקטורים יתומים (chunks) שאין להם מסמך אב
4. ניקוי embeddings יתומים שאין להם מסמך אב
5. הפעלת כל פעולות הניקוי

### שימוש בכלי הניקוי

1. **מחיקת מסמך בעייתי:**
   ```bash
   python cleanup_database.py --delete-document 120
   ```

2. **ניקוי כללי של מסד הנתונים:**
   ```bash
   python cleanup_database.py
   ```
   ואז בחר באפשרות 5 להפעלת כל פעולות הניקוי.

## השיפורים במעבד המסמכים

בנוסף לכלי הניקוי, בוצעו גם שיפורים במעבד המסמכים עצמו (`document_processor.py`):

1. **הגבלת מספר הווקטורים למסמך** - נקבעה מגבלה של 1000 וקטורים מקסימום למסמך.
2. **שיפור אלגוריתם החלוקה** - הוחלף אלגוריתם החלוקה הסמנטי שהיה מייצר יותר מדי וקטורים באלגוריתם מבוסס אורך קבוע.
3. **הגבלת עיבוד** - נוספו בדיקות במהלך העיבוד כדי להפסיק את התהליך אם מגיעים למגבלת הווקטורים.

## טיפול במסמכים גדולים

אם אתה צריך לעבד מסמכים גדולים במיוחד, מומלץ:

1. לחלק אותם למסמכים קטנים יותר לפני העלאה
2. לנסות לצמצם את התוכן לחלקים הרלוונטיים ביותר
3. לשנות את קבוע `MAX_VECTORS_PER_DOCUMENT` בקובץ `document_processor.py` לערך גדול יותר אם יש צורך בכך (עם זהירות)

## לאחר ניקוי

לאחר ביצוע ניקוי, מומלץ:

1. לבדוק את הלוגים כדי לוודא שהפעולות הצליחו
2. לבדוק את מסד הנתונים כדי לוודא שהמסמכים שנמחקו אכן נעלמו
3. לבדוק את פונקציית החיפוש כדי לוודא שהמערכת עובדת כראוי 